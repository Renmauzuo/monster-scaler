{"version":3,"file":"sidekicks.min.js","sources":["src/scripts/sidekicks.js"],"sourcesContent":["let sidekickStats;\r\n$(function () {\r\n    populateSelect(monsterList, '#creature');\r\n    populateSelect(sidekickClasses, '#class');\r\n    populateSelect(armorTypes, '#armor'); //TODO: Filter armor by proficiency\r\n    populateSelect(weaponTypes, '#weapon'); //TODO: Filter weapons by proficiency, allow multiple weapons\r\n    deserializeQuery();\r\n\r\n    //Pretty much any input change means a recalculation\r\n    $('input,select').on('change', buildSelectedSidekick);\r\n    buildSelectedSidekick();\r\n\r\n});\r\n\r\nfunction buildSelectedSidekick() {\r\n    let monsterID = $('#creature').val();\r\n    let customName = $('#name').val();\r\n    let customGender = parseInt($('#gender').val());\r\n    let level = parseInt($('#level').val());\r\n    let classID = $('#class').val();\r\n    let selectedClass = sidekickClasses[classID];\r\n\r\n    //Gather up options to pass to the calculator\r\n    let options = {};\r\n    if ($('#variant').is(':visible')) {\r\n        options.variant = $('#variant').val();\r\n    }\r\n    if ($('#race-select').is(':visible')) {\r\n        options.race = $('#race-select').val();\r\n    }\r\n\r\n    //Generate a direct link to this specific creature and stat set\r\n    let directLink = location.toString().replace(location.search, \"\");\r\n    directLink += '?' + serializeForm($('#sidekick-form'));\r\n    $('#direct-link').attr('href', directLink);\r\n\r\n    sidekickStats = scaleMonster(monsterID, '0.5', options);\r\n\r\n    //Delete the sidekick's CR, since sidekicks do not have a challenge rating\r\n    delete sidekickStats.cr;\r\n\r\n    //Adjust for sidekick level\r\n    sidekickStats.level = level;\r\n    sidekickStats.hitDice += level;\r\n    sidekickStats.proficiency = averageStats[level].proficiency;\r\n\r\n    //Disable any skills the sidekick already has in the \"bonus proficiencies\" select\r\n    $('#bonus-skills option').attr('disabled', false);\r\n    for (let skill in sidekickStats.skills) {\r\n        $('#bonus-skills option[value='+skill+']').attr('disabled', true);\r\n    }\r\n\r\n    let bonusSkills = $('#bonus-skills').val();\r\n    if (bonusSkills.length) {\r\n        sidekickStats.skills = sidekickStats.skills || [];\r\n        for (let i = 0; i < bonusSkills.length; i++) {\r\n            let skill = bonusSkills[i];\r\n            if (!sidekickStats.skills[skill]) {\r\n                sidekickStats.skills[skill] = 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let bonusSave = $('#bonus-save').val();\r\n    if (bonusSave && bonusSave.length) {\r\n        sidekickStats.saves = sidekickStats.saves || [];\r\n        sidekickStats.saves.push(bonusSave);\r\n    }\r\n\r\n    //Apply any customizations to the derived statblock\r\n    if (customGender) {\r\n        sidekickStats.gender = customGender;\r\n    }\r\n\r\n    if (customName) {\r\n        //If there's a custom name assign that.\r\n        //No need to save the original name like we do for mosnters since there are no wild shapes here\r\n        sidekickStats.name = customName;\r\n        sidekickStats.description = customName;\r\n    } else {\r\n        sidekickStats.name = toSentenceCase(classID) + ' (' + sidekickStats.name + ')';\r\n        sidekickStats.description = 'the ' + classID;\r\n    }\r\n\r\n    let asiFilter = selectedClass.asi.filter(function (x) {\r\n        return x <= level;\r\n    });\r\n    //2 ASI points per level that gives an ASI\r\n    let asiCount = asiFilter.length * 2;\r\n    //Calculate the max of each asi input. This is based on how many ASI points are available, as well as the creature's ability scores (since the cap is 20)\r\n    if (asiCount) {\r\n        //Before we begin we need to calculate how many points are already spent\r\n        let asiSpent = 0;\r\n        $('#asi-wrapper input').each(function () {\r\n            asiSpent += parseInt($(this).val());\r\n        });\r\n        let asiAvailable = asiCount - asiSpent;\r\n        $('#asi-points').html(asiAvailable);\r\n        asiAvailable != 1 ? $('#asi-plural').show() : $('#asi-plural').hide();\r\n\r\n        $('#asi-wrapper input').each(function () {\r\n            let ability = $(this).data('ability');\r\n            let currentValue = parseInt($(this).val());\r\n            \r\n            //First determine the absolute max based on the creature's ability score\r\n            //Unlikely for a CR 1/2 creature to have over 20 in a stat but y'never know\r\n            let abilityMax = Math.max(0, 20 - sidekickStats[ability]);\r\n            \r\n            //The second possible max is the number of available points PLUS any already spent on this ability\r\n            let asiMax = asiAvailable + currentValue;\r\n\r\n            $(this).attr('max', Math.min(abilityMax, asiMax));\r\n            $('#asi-'+ability+'-current span').html(currentValue);\r\n\r\n            //While we're here add the ability to the statblock\r\n            sidekickStats[ability] += currentValue;\r\n            sidekickStats.abilityModifiers[ability] = abilityScoreModifier(sidekickStats[ability]);\r\n        });\r\n    }\r\n\r\n    let earnedFeatures = selectedClass.features.filter(function (x) {\r\n        return x.level <= level;\r\n    });\r\n    for (let i = 0; i < earnedFeatures.length; i++) {\r\n        let feature = earnedFeatures[i];\r\n        if (feature.trait) {\r\n            sidekickStats.traits[feature.trait] = traits[feature.trait];\r\n            if (feature.options) {\r\n                for (let j = 0; j < feature.options.length; j++) {\r\n                    let option = feature.options[j];\r\n                    let $select = $('#'+option.id);\r\n                    let value = $select.val();\r\n                    option.result(sidekickStats, value);\r\n\r\n                    //Refresh the option list in case any other changes affect it\r\n                    let list = (typeof option.list === 'function') ? option.list(sidekickStats) : option.list;\r\n                    $select.empty();\r\n                    populateSelect(list, $select);\r\n                \r\n                    //Reapply the value if there is oneso it's not lost every refresh\r\n                    if (value) {\r\n                        $select.val(value);\r\n                    } else {\r\n                        //If there isn't an existing value see if one exists in a query param\r\n                        let params = new URLSearchParams(location.search);\r\n                        let paramValue = params.get(option.id);\r\n                        if (paramValue) {\r\n                            $select.val(paramValue);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //Apply role bonuses\r\n    if ($('#role').is(':visible')) {\r\n        let selectedRole = selectedClass.roles[$('#role').val()];\r\n        if (selectedRole.merge) {\r\n            sidekickStats = mergeObjects(sidekickStats, selectedRole.merge);\r\n        }\r\n    }\r\n\r\n    //Apply armor\r\n    if ($('#armor').val() != 'None') {\r\n        sidekickStats.armor = $('#armor').val();\r\n        sidekickStats.bonusArmor += parseInt($('#armor-enhancement').val());\r\n    }\r\n\r\n    //Apply weapon\r\n    if ($('#weapon').val() != 'None') {\r\n        let weapon = Object.assign({}, weaponTypes[$('#weapon').val()]);\r\n        weapon.enhancement = parseInt($('#weapon-enhancement').val());\r\n        sidekickStats.attacks[$('#weapon').val()] = weapon;\r\n    }\r\n\r\n    //Once we have all the stats populate the statblock:\r\n    renderStatblock(sidekickStats);\r\n}\r\n\r\n/**\r\n * Makes changes to the form based on selected class:\r\n * Shows or hides the role dropdown based on the current class, and populates it with any role options.\r\n * Updates the list of bonus proficiencies\r\n *\r\n * @param {boolean} animated Whether or not to animate the show/hide\r\n */\r\nfunction onClassChange(animated) {\r\n    let animationDuration = animated ? 400 : 0;\r\n    let classID = $('#class').val();\r\n    let selectedClass = sidekickClasses[classID];\r\n\r\n    if (selectedClass.roles) {\r\n        $('#role').empty();\r\n        populateSelect(selectedClass.roles, '#role');\r\n        $('#role-wrapper').fadeIn(animationDuration);\r\n    } else {\r\n        $('#role-wrapper').fadeOut(animationDuration);\r\n    }\r\n\r\n    $('#bonus-skills').empty().data('limit', selectedClass.bonusProficiencies.count);\r\n    $('#bonus-skill-count').html(selectedClass.bonusProficiencies.count);\r\n    if (selectedClass.bonusProficiencies.skills) {\r\n        for (let i = 0; i < selectedClass.bonusProficiencies.skills.length; i++) {\r\n            let key = selectedClass.bonusProficiencies.skills[i];\r\n            $('<option value='+key+'>'+(skills[key].name || toSentenceCase(key))+'</option>').appendTo('#bonus-skills');\r\n        }\r\n    } else {\r\n        //If there's no list of skills use all\r\n        populateSelect(skills, '#bonus-skills');\r\n    }\r\n\r\n    $('#bonus-save').empty();\r\n    for (let i = 0; i < selectedClass.bonusProficiencies.saves.length; i++) {\r\n        let key = selectedClass.bonusProficiencies.saves[i];\r\n        $('<option value='+key+'>'+abilities[key].name+'</option>').appendTo('#bonus-save');\r\n    }\r\n\r\n    //Delete old feature inputs when changing class\r\n    $('#class-features').empty();\r\n    //Create new class feature inputs if necessary\r\n    for (let i = 0; i < selectedClass.features.length; i++) {\r\n        let feature = selectedClass.features[i];\r\n        if (feature.options) {\r\n            for (let j = 0; j < feature.options.length; j++) {\r\n                let featureOption = feature.options[j];\r\n                let $wrapper = $('<div data-level='+feature.level+'></div>');\r\n                $('<label for='+featureOption.id+'>'+featureOption.label+'</label>').appendTo($wrapper);\r\n    \r\n                let $select = $('<select id='+featureOption.id+' name='+featureOption.id+'></select>');\r\n                if (featureOption.limit) {\r\n                    //Just set the multiple attribute for now. Actual limit will need to be set elsewhere, as it depends on other factors.\r\n                    $select.attr('multiple',true);\r\n                }\r\n\r\n                $select.appendTo($wrapper);    \r\n                $wrapper.appendTo('#class-features');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Handles certain changes based on character level, such as showing and hiding inputs for class specific features\r\n *\r\n * @param {boolean} animated Whether or not to animate the show/hide\r\n */\r\nfunction onLevelChange(animated) {\r\n    let animationDuration = animated ? 400 : 0;\r\n    let level = parseInt($('#level').val());\r\n    let classID = $('#class').val();\r\n    let selectedClass = sidekickClasses[classID];\r\n    //Show ASI inputs if sidekick qualifies\r\n    //While different classes get ASIs at different levels, getting the first one at 4 is pretty universal\r\n    if (level >= 4) {\r\n        $('#asi-wrapper').slideDown(animationDuration);\r\n    } else {\r\n        $('#asi-wrapper').slideUp(animationDuration);\r\n    }\r\n    //Range max will also be adjusted, but that can't be done until after the monster is scaled, since we need its ability scores to determine the cap\r\n    //This is just done here so the ASI Wrapper is shown/hidden appropriately on page load based on the query params\r\n\r\n    //Update features based on new level\r\n    $('[data-level]').each(function () {\r\n        if ($(this).data('level') > level) {\r\n            $(this).slideUp(animated);\r\n        } else {\r\n            $(this).slideDown(animated);            \r\n        }\r\n    });\r\n}\r\n"],"names":["sidekickStats","$","populateSelect","monsterList","sidekickClasses","armorTypes","weaponTypes","deserializeQuery","on","buildSelectedSidekick","monsterID","val","customName","customGender","parseInt","level","classID","selectedClass","options","is","variant","race","directLink","location","toString","replace","search","serializeForm","attr","scaleMonster","cr","hitDice","proficiency","averageStats","skill","skills","bonusSkills","length","i","bonusSave","saves","push","gender","name","description","toSentenceCase","asiFilter","asi","filter","x","asiCount","asiSpent","each","asiAvailable","html","show","hide","ability","data","currentValue","abilityMax","Math","max","asiMax","min","abilityModifiers","abilityScoreModifier","earnedFeatures","features","feature","trait","traits","j","option","$select","id","value","result","list","empty","params","URLSearchParams","paramValue","get","selectedRole","roles","merge","mergeObjects","armor","bonusArmor","weapon","Object","assign","enhancement","attacks","renderStatblock","onClassChange","animated","animationDuration","fadeIn","fadeOut","bonusProficiencies","count","key","appendTo","abilities","featureOption","$wrapper","label","limit","onLevelChange","slideDown","slideUp"],"mappings":"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"}